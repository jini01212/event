<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('ì˜ˆë§¤ ì™„ë£Œ')}"></head>

<body class="d-flex flex-column min-vh-100">
<div th:replace="~{layout :: navbar}"></div>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- ì§„í–‰ ë‹¨ê³„ í‘œì‹œ -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-center">
                        <div class="d-flex align-items-center">
                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="bg-success" style="width: 100px; height: 2px;"></div>
                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="bg-success" style="width: 100px; height: 2px;"></div>
                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center mt-2">
                        <small class="text-success me-4 fw-bold">ì •ë³´ì…ë ¥</small>
                        <small class="text-success me-4 fw-bold">ê²°ì œí•˜ê¸°</small>
                        <small class="text-success fw-bold">ì™„ë£Œ</small>
                    </div>
                </div>
            </div>

            <!-- ì™„ë£Œ ë©”ì‹œì§€ -->
            <div class="text-center mb-5">
                <div class="mb-4">
                    <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 80px; height: 80px;">
                        <i class="fas fa-check fa-3x"></i>
                    </div>
                </div>
                <h1 class="display-5 mb-3 text-success">ì˜ˆë§¤ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰</h1>
                <p class="lead text-muted">
                    ê²°ì œ í™•ì¸ í›„ í‹°ì¼“ì´ ë°œê¸‰ë©ë‹ˆë‹¤.<br>
                    í‹°ì¼“ ì •ë³´ëŠ” ë“±ë¡í•˜ì‹  ì´ë©”ì¼ë¡œë„ ë°œì†¡ë©ë‹ˆë‹¤.
                </p>
            </div>

            <!-- í‹°ì¼“ ì •ë³´ ì¹´ë“œ -->
            <div class="card shadow-lg mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-ticket-alt me-2"></i>ì˜ˆë§¤ ì •ë³´
                    </h4>
                </div>
                <div class="card-body">
                    <!-- í‹°ì¼“ë²ˆí˜¸ - í•˜ì´ë¼ì´íŠ¸ -->
                    <div class="alert alert-primary text-center mb-4">
                        <h6 class="mb-2">í‹°ì¼“ë²ˆí˜¸</h6>
                        <div class="display-6 ticket-number fw-bold" th:text="${reservation.ticketNumber}"></div>
                        <button class="btn btn-outline-primary btn-sm mt-2"
                                onclick="copyTicketNumber(this)"
                                th:data-ticket="${reservation.ticketNumber}">
                            <i class="fas fa-copy me-1"></i>í‹°ì¼“ë²ˆí˜¸ ë³µì‚¬
                        </button>
                    </div>

                    <!-- ìƒì„¸ ì •ë³´ -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-calendar me-2"></i>ì´ë²¤íŠ¸</h6>
                                <p class="fw-bold mb-0" th:text="${reservation.event.title}"></p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-clock me-2"></i>ì¼ì‹œ</h6>
                                <p class="mb-0" th:text="${#temporals.format(reservation.event.eventDate, 'yyyyë…„ MMì›” ddì¼ (E) HH:mm')}"></p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-map-marker-alt me-2"></i>ì¥ì†Œ</h6>
                                <p class="mb-0" th:text="${reservation.event.location}"></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-user me-2"></i>ì˜ˆë§¤ì</h6>
                                <p class="mb-0" th:text="${reservation.customerName}"></p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-envelope me-2"></i>ì´ë©”ì¼</h6>
                                <p class="mb-0" th:text="${reservation.customerEmail}"></p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-muted mb-1"><i class="fas fa-ticket-alt me-2"></i>ìˆ˜ëŸ‰ & ê¸ˆì•¡</h6>
                                <p class="mb-0">
                                    <span th:text="${reservation.ticketCount}"></span>ë§¤ Â·
                                    <span class="fw-bold text-primary" th:text="${#numbers.formatDecimal(reservation.totalPrice, 0, 'COMMA', 0, 'POINT')} + 'ì›'"></span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ì œ ìƒíƒœ -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="d-flex align-items-center justify-content-between p-3 bg-light rounded">
                                <div>
                                    <h6 class="mb-1">ê²°ì œ ìƒíƒœ</h6>
                                    <span th:if="${reservation.paymentStatus.name() == 'PENDING'}"
                                          class="badge bg-warning fs-6">
                                        <i class="fas fa-clock me-1"></i>ê²°ì œ í™•ì¸ ì¤‘
                                    </span>
                                    <span th:if="${reservation.paymentStatus.name() == 'COMPLETED'}"
                                          class="badge bg-success fs-6">
                                        <i class="fas fa-check me-1"></i>ê²°ì œ ì™„ë£Œ
                                    </span>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted">ì˜ˆë§¤ì¼ì‹œ</small><br>
                                    <small th:text="${#temporals.format(reservation.createdAt, 'yyyy.MM.dd HH:mm')}"></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="alert alert-info">
                <h6><i class="fas fa-lightbulb me-2"></i>ì•ˆë‚´ì‚¬í•­</h6>
                <ul class="mb-0">
                    <li><strong>í‹°ì¼“ë²ˆí˜¸ë¥¼ ë°˜ë“œì‹œ ê¸°ì–µí•´ë‘ì„¸ìš”!</strong> í˜„ì¥ ì…ì¥ì‹œ í•„ìš”í•©ë‹ˆë‹¤</li>
                    <li>ê²°ì œ í™•ì¸ í›„ ì´ë©”ì¼ë¡œ í‹°ì¼“ ì •ë³´ë¥¼ ë°œì†¡í•´ë“œë¦½ë‹ˆë‹¤</li>
                    <li>í˜„ì¥ì—ì„œ í‹°ì¼“ë²ˆí˜¸ í™•ì¸ìœ¼ë¡œ ì…ì¥í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    <li>ì˜ˆë§¤ ê´€ë ¨ ë¬¸ì˜ëŠ” ê³ ê°ì„¼í„°(1588-0000)ë¡œ ì—°ë½ì£¼ì„¸ìš”</li>
                </ul>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="text-center mt-4">
                <div class="d-grid gap-2 d-md-block">
                    <a href="/" class="btn btn-primary btn-lg">
                        <i class="fas fa-home me-2"></i>ë©”ì¸ìœ¼ë¡œ
                    </a>
                    <a href="/my-tickets" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-list me-2"></i>ë‚´ í‹°ì¼“ í™•ì¸
                    </a>
                    <button class="btn btn-outline-success btn-lg" onclick="shareTicket()">
                        <i class="fas fa-share me-2"></i>ê³µìœ í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    const ticketNumber = /*[[${reservation.ticketNumber}]]*/ '';
    const eventTitle = /*[[${reservation.event.title}]]*/ '';

    function copyTicketNumber(button) {
        const ticketNum = button.getAttribute('data-ticket');
        navigator.clipboard.writeText(ticketNum).then(function() {
            button.innerHTML = '<i class="fas fa-check me-1"></i>ë³µì‚¬ì™„ë£Œ!';
            button.classList.remove('btn-outline-primary');
            button.classList.add('btn-success');

            setTimeout(function() {
                button.innerHTML = '<i class="fas fa-copy me-1"></i>í‹°ì¼“ë²ˆí˜¸ ë³µì‚¬';
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-primary');
            }, 2000);
        });
    }

    function shareTicket() {
        if (navigator.share) {
            navigator.share({
                title: 'ì´ë²¤íŠ¸ ì˜ˆë§¤ ì™„ë£Œ',
                text: `${eventTitle} ì˜ˆë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í‹°ì¼“ë²ˆí˜¸: ${ticketNumber}`,
                url: window.location.href
            });
        } else {
            // Web Share APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°
            const text = `${eventTitle} ì˜ˆë§¤ ì™„ë£Œ! í‹°ì¼“ë²ˆí˜¸: ${ticketNumber}`;
            navigator.clipboard.writeText(text).then(function() {
                alert('ê³µìœ  í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¶•í•˜ ì• ë‹ˆë©”ì´ì…˜
    document.addEventListener('DOMContentLoaded', function() {
        // ê°„ë‹¨í•œ ì¶•í•˜ íš¨ê³¼
        setTimeout(function() {
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
        }, 500);
    });
</script>
</body>
</html>